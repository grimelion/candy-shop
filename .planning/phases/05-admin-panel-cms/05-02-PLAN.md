---
phase: 05-admin-panel-cms
plan: 02
type: execute
---

<objective>
Create the editable config data layer backed by Vercel Blob.

Purpose: All site content is currently hardcoded in TypeScript const files. This plan introduces a unified `SiteConfig` type that mirrors that structure, plus read/write helpers using `@vercel/blob`. The site keeps working via hardcoded defaults when no blob config exists yet.

Output: `src/types/site-config.ts` with full types, `src/lib/site-config.ts` with `getSiteConfig()` and `saveSiteConfig()` helpers, `@vercel/blob` installed.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/content/site.ts
@src/content/sections.ts
@src/components/board-size-selector.tsx
@.planning/phases/05-admin-panel-cms/05-01-SUMMARY.md

**Tech stack available:** Next.js 15 App Router, TypeScript, @vercel/blob (to be installed)

**Established patterns:** TypeScript const exports in src/content/, `as const` for static data

**Constraining decisions:**
- Phase 3.1: Board images are currently in /public/images/boards/ — admin will upload replacements to Vercel Blob, URLs stored in config
- The config must be a superset of existing src/content/site.ts + src/content/sections.ts + board-size-selector.tsx data so it can eventually replace all of them
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install @vercel/blob and define SiteConfig types</name>
  <files>src/types/site-config.ts</files>
  <action>
Run `npm install @vercel/blob`.

Create `src/types/site-config.ts` with TypeScript interfaces that mirror ALL current hardcoded content:

```ts
export interface BoardSize {
  id: string;
  name: string;
  price: string;
  weight: string;
  serves: string;
  description: string;
  imageUrl: string; // URL (Vercel Blob or /public path)
  popular: boolean;
}

export interface Testimonial {
  name: string;
  review: string;
  rating: number;
}

export interface FeaturedItem {
  title: string;
  description: string;
  image: string;
}

export interface SiteConfig {
  // Store info (from site.ts)
  storeName: string;
  tagline: string;
  phone: string;
  address: string;
  hours: {
    sunday: string;
    monday: string;
    tuesday: string;
    wednesday: string;
    thursday: string;
    friday: string;
    saturday: string;
  };
  social: {
    instagram: string;
    yelp: string;
    facebook: string;
  };

  // Section content (from sections.ts)
  hero: {
    headline: string;
    subhead: string;
    primaryCTA: string;
  };
  featured: {
    title: string;
    items: FeaturedItem[];
  };
  gallery: {
    title: string;
    description: string;
  };
  b2b: {
    title: string;
    description: string;
    services: string[];
  };
  testimonials: {
    title: string;
    items: Testimonial[];
  };
  location: {
    title: string;
    description: string;
  };

  // Board config (from board-size-selector.tsx)
  boards: BoardSize[];
}
```
  </action>
  <verify>`npm run build` — TypeScript compiles with no errors on the new types file.</verify>
  <done>src/types/site-config.ts exists, all interfaces defined, no TypeScript errors</done>
</task>

<task type="auto">
  <name>Task 2: Create getSiteConfig and saveSiteConfig helpers</name>
  <files>src/lib/site-config.ts</files>
  <action>
Create `src/lib/site-config.ts`:

**Default config** — copy the exact current hardcoded values from site.ts, sections.ts, and board-size-selector.tsx into a `DEFAULT_CONFIG: SiteConfig` const. This ensures the site works identically before any admin edits.

For boards default, use the current three boards from board-size-selector.tsx (small $45, medium $85, large $160) with `imageUrl` set to the current `/public` paths (`/images/boards/small.jpeg`, etc.).

**`getSiteConfig()` function:**
```ts
import { list } from '@vercel/blob';

export async function getSiteConfig(): Promise<SiteConfig> {
  try {
    const token = process.env.BLOB_READ_WRITE_TOKEN;
    if (!token) return DEFAULT_CONFIG;

    const { blobs } = await list({ prefix: 'site-config.json', token });
    if (!blobs.length) return DEFAULT_CONFIG;

    const res = await fetch(blobs[0].url, { next: { revalidate: 60 } });
    if (!res.ok) return DEFAULT_CONFIG;

    const config = await res.json();
    return { ...DEFAULT_CONFIG, ...config }; // merge so new fields always have defaults
  } catch {
    return DEFAULT_CONFIG;
  }
}
```

**`saveSiteConfig()` function:**
```ts
import { put } from '@vercel/blob';

export async function saveSiteConfig(config: SiteConfig): Promise<void> {
  const token = process.env.BLOB_READ_WRITE_TOKEN;
  if (!token) throw new Error('BLOB_READ_WRITE_TOKEN not set');

  await put('site-config.json', JSON.stringify(config, null, 2), {
    access: 'public',
    addRandomSuffix: false,
    token,
    contentType: 'application/json',
  });
}
```

**`uploadBoardImage()` function** for image uploads in plan 05-05:
```ts
import { put } from '@vercel/blob';

export async function uploadBoardImage(boardId: string, file: File): Promise<string> {
  const token = process.env.BLOB_READ_WRITE_TOKEN;
  if (!token) throw new Error('BLOB_READ_WRITE_TOKEN not set');

  const ext = file.name.split('.').pop() ?? 'jpg';
  const blob = await put(`boards/${boardId}.${ext}`, file, {
    access: 'public',
    addRandomSuffix: false,
    token,
  });
  return blob.url;
}
```

Add `BLOB_READ_WRITE_TOKEN=` to `.env` (leave empty — it will be populated from Vercel dashboard when deploying; locally, getSiteConfig returns DEFAULT_CONFIG gracefully).
  </action>
  <verify>
1. `npm run build` passes — no TypeScript errors
2. `npm run dev` starts
3. Create a quick test: in any Server Component, call `getSiteConfig()` and log the result — should return DEFAULT_CONFIG (since BLOB_READ_WRITE_TOKEN is empty locally)
  </verify>
  <done>src/lib/site-config.ts exports getSiteConfig, saveSiteConfig, uploadBoardImage; all return correct types; builds without errors</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds with no TypeScript errors
- [ ] `@vercel/blob` in package.json dependencies
- [ ] `src/types/site-config.ts` contains complete SiteConfig interface
- [ ] `getSiteConfig()` returns DEFAULT_CONFIG when BLOB_READ_WRITE_TOKEN is not set
- [ ] DEFAULT_CONFIG values match current hardcoded content exactly
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors introduced
- SiteConfig type covers all editable content fields
- Helpers handle missing token and blob gracefully (fallback to defaults)
  </success_criteria>

<output>
After completion, create `.planning/phases/05-admin-panel-cms/05-02-SUMMARY.md`:

```markdown
---
phase: 05-admin-panel-cms
plan: 02
subsystem: data
tags: [vercel-blob, typescript, config]

requires:
  - phase: 05-admin-panel-cms plan 01
    provides: Admin auth
provides:
  - SiteConfig TypeScript types
  - getSiteConfig() — reads from Vercel Blob with default fallback
  - saveSiteConfig() — writes to Vercel Blob
  - uploadBoardImage() — uploads board image to Vercel Blob
affects: [05-admin-panel-cms]

tech-stack:
  added: [@vercel/blob]
  patterns:
    - Vercel Blob for persistent config JSON and image storage
    - Merge-with-defaults pattern for forward-compatible config reads

key-files:
  created:
    - src/types/site-config.ts
    - src/lib/site-config.ts

key-decisions:
  - "list({ prefix: 'site-config.json' }) to find blob — no need to store URL separately"
  - "addRandomSuffix: false for deterministic blob paths"
  - "Merge DEFAULT_CONFIG + stored config so new fields always have fallback values"

patterns-established:
  - getSiteConfig() is the single source of truth for all editable site content

issues-created: []
---

# Phase 5 Plan 2: Config Data Layer Summary

**[Substantive one-liner]**

## Accomplishments

## Files Created/Modified

## Decisions Made

## Issues Encountered

## Next Step

Ready for 05-03-PLAN.md
```
</output>
