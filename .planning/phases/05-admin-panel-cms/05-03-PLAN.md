---
phase: 05-admin-panel-cms
plan: 03
type: execute
---

<objective>
Update all site components to read content from getSiteConfig() instead of hardcoded TypeScript imports.

Purpose: Currently all content is imported directly from src/content/*.ts at build time. This plan wires the getSiteConfig() data layer into the site so admin edits take effect on the live site within 60 seconds (ISR revalidation).

Output: Home page and order page fetch config server-side; all section components accept data as props instead of importing directly from src/content/. src/content/*.ts files remain as-is (they become the fallback values inside DEFAULT_CONFIG in site-config.ts).
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/app/page.tsx
@src/app/order/page.tsx
@src/components/board-size-selector.tsx
@src/components/order-form-section.tsx
@src/content/site.ts
@src/content/sections.ts
@src/lib/site-config.ts
@src/types/site-config.ts
@.planning/phases/05-admin-panel-cms/05-02-SUMMARY.md

**Tech stack available:** Next.js 15 App Router, TypeScript, getSiteConfig() from src/lib/site-config.ts

**Established patterns:**
- Server Components can be async (see src/app/order/page.tsx and src/app/b2b/page.tsx for pattern)
- Client components receive data as props from parent Server Components
- OrderFormSection is a Client Component that receives props from order/page.tsx

**Constraining decisions:**
- src/content/*.ts files are NOT deleted — they stay as documentation of the data shape and are referenced by DEFAULT_CONFIG in site-config.ts
- Do NOT convert Client Components to Server Components — only pass new props down from the async page
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update home page to fetch config and pass section data as props</name>
  <files>src/app/page.tsx</files>
  <action>
First, grep for all files importing from `@/content/site` and `@/content/sections`:
```bash
grep -r "@/content/site\|@/content/sections" src/ --include="*.tsx" --include="*.ts" -l
```

Read src/app/page.tsx to understand its current structure.

Make `src/app/page.tsx` an async Server Component:
- Add `import { getSiteConfig } from '@/lib/site-config'` at the top
- At the top of the default export function, add `const config = await getSiteConfig()`
- For each section component that uses content from `sections` or `siteConfig`, pass the relevant data as props

For each component found in the grep that directly imports from `@/content/site` or `@/content/sections`:
- Remove the direct import from the component file
- Add the appropriate prop to the component's Props interface (e.g., `hero: SiteConfig['hero']`, `storeName: string`, etc.)
- Update the component to use the prop instead of the imported const
- Pass the prop from page.tsx using `config.hero`, `config.storeName`, etc.

**Key components to update (check actual grep output first):**
- Hero component: likely uses `sections.hero`
- FeatureCards/featured section: likely uses `sections.featured`
- Testimonials: likely uses `sections.testimonials`
- Gallery section: likely uses `sections.gallery`
- B2B section: likely uses `sections.b2b`
- Location section: likely uses `sections.location`
- Components using `siteConfig` (phone, hours, address): pass specific fields as props

**For client components** that receive store info (e.g., sticky-order-bar.tsx uses `siteConfig.phone`):
- Option A: Pass phone as a prop from the parent Server Component
- Option B: If the component is used in layout.tsx (which is not async), keep the direct import for now — flag it in SUMMARY.md as a deferred item

Do NOT break any existing component that doesn't import from content files.
  </action>
  <verify>
1. `npm run build` passes with no TypeScript errors
2. `npm run dev` starts — home page loads and looks identical to before
3. All sections render with the same content
  </verify>
  <done>Home page is async, fetches config via getSiteConfig(), all section components receive data as props, no direct content imports remain in updated components</done>
</task>

<task type="auto">
  <name>Task 2: Update order page and BoardSizeSelector to use config</name>
  <files>src/app/order/page.tsx, src/components/board-size-selector.tsx, src/components/order-form-section.tsx</files>
  <action>
Update `src/app/order/page.tsx`:
- Make it async
- Import `getSiteConfig` from `@/lib/site-config`
- Fetch: `const config = await getSiteConfig()`
- Pass `boards={config.boards}` as prop to `OrderFormSection`

Update `src/components/order-form-section.tsx`:
- Add `boards: BoardSize[]` to props interface (import `BoardSize` from `@/types/site-config`)
- Replace the hardcoded import of `boardImages` and `BoardSizeSelector`'s internal `boardSizes` with the passed `boards` prop
- Pass `boards={boards}` to `BoardSizeSelector`
- Update `boardImages` map dynamically from the `boards` array: `const boardImages = Object.fromEntries(boards.map(b => [b.id, b.imageUrl]))`

Update `src/components/board-size-selector.tsx`:
- Remove the hardcoded `boardSizes` const and `boardImages` export
- Add `boards: BoardSize[]` to props interface (import `BoardSize` from `@/types/site-config`)
- Replace `boardSizes.map(...)` with `boards.map(...)`
- Ensure all field references match `BoardSize` type (`size.imageUrl` instead of `size.image`)

**Verify sticky-order-bar.tsx** still compiles (it uses `siteConfig.phone` directly from `@/content/site` — if it's used in layout.tsx keep the direct import for now since layout is not easily made async; note this in SUMMARY.md).
  </action>
  <verify>
1. `npm run build` passes with no TypeScript errors
2. `npm run dev` starts
3. Visit /order — page loads, all 3 board size options display correctly with same prices and images as before
4. Select a board size — preview image updates correctly
5. Fill and submit order form — success state appears
  </verify>
  <done>Order page is async, fetches board config, BoardSizeSelector renders from config data, all existing functionality preserved</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds with no TypeScript errors
- [ ] Home page renders identically to before (all sections, same content)
- [ ] Order page renders identically to before (board sizes, images, form)
- [ ] No direct imports of `sections` or `siteConfig` remain in updated components (verify with grep)
- [ ] `npm run lint` passes
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors introduced
- Site looks and functions identically to before (data comes from getSiteConfig defaults)
- Admin edits will now propagate to the live site within 60 seconds
  </success_criteria>

<output>
After completion, create `.planning/phases/05-admin-panel-cms/05-03-SUMMARY.md`:

```markdown
---
phase: 05-admin-panel-cms
plan: 03
subsystem: data
tags: [server-components, props, refactor]

requires:
  - phase: 05-admin-panel-cms plan 02
    provides: getSiteConfig() helper
provides:
  - Home page reads all section content from getSiteConfig()
  - Order page reads board config from getSiteConfig()
  - All section components accept content as props
affects: [05-admin-panel-cms]

tech-stack:
  added: []
  patterns:
    - Async Server Component pages with getSiteConfig() at top
    - Content passed as props from Server to Client components

key-files:
  modified:
    - src/app/page.tsx
    - src/app/order/page.tsx
    - src/components/board-size-selector.tsx
    - src/components/order-form-section.tsx
    - [other section components updated]

key-decisions:
  - "src/content/*.ts kept as-is — not deleted, remains as default value reference"
  - [Any deferred items, e.g., sticky-order-bar still uses direct import]

patterns-established:
  - All editable content flows from getSiteConfig() through async page → component props

issues-created: []
---

# Phase 5 Plan 3: Update Site to Use Config Summary

**[Substantive one-liner]**

## Accomplishments

## Files Created/Modified

## Decisions Made

## Issues Encountered

## Next Step

Ready for 05-04-PLAN.md
```
</output>
