---
phase: 05-admin-panel-cms
plan: 04
type: execute
---

<objective>
Build the admin dashboard shell and store info editor.

Purpose: The owner needs a clean, usable admin UI. This plan creates the admin layout with navigation and logout, plus the first editor: store name, phone, address, business hours, and social links.

Output: /admin dashboard with sidebar nav, /admin/site-info editor that saves store info changes to Vercel Blob via saveSiteConfig().
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/app/admin/actions.ts
@src/lib/site-config.ts
@src/types/site-config.ts
@src/components/ui/button.tsx
@src/components/ui/card.tsx
@.planning/phases/05-admin-panel-cms/05-03-SUMMARY.md

**Tech stack available:** Next.js 15 App Router, TypeScript, Tailwind CSS v4, shadcn/ui (Button, Card, Input, Label, Textarea), react-hook-form, zod, getSiteConfig/saveSiteConfig from src/lib/site-config.ts

**Established patterns:**
- Server actions with "use server" directive, Zod validation, react-hook-form with zodResolver
- logoutAction() already exists in src/app/admin/actions.ts (from plan 05-01)
- Admin pages live under src/app/admin/

**Constraining decisions:**
- Admin UI should be functional and clean, not polished — the owner uses it occasionally, not customers
- Use existing shadcn/ui components for inputs, cards, buttons — do NOT install new UI libraries
- Forms use react-hook-form + zod (consistent with rest of codebase)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create admin layout and dashboard index</name>
  <files>src/app/admin/layout.tsx, src/app/admin/page.tsx</files>
  <action>
Create `src/app/admin/layout.tsx` (Server Component):
- Import `logoutAction` from `./actions`
- Render a two-column layout: left sidebar (w-56) + main content area
- Sidebar contains:
  - "Admin Panel" heading
  - Nav links (Next.js `<Link>`): "Store Info" → /admin/site-info, "Content" → /admin/content, "Boards" → /admin/boards
  - Logout button at the bottom (form with action={logoutAction}, Button type="submit" variant="outline")
- Sidebar uses a subtle background (bg-gray-50 or bg-slate-50)
- No metadata export needed — this is a private admin area

Create `src/app/admin/page.tsx` (Server Component):
- Simple dashboard: "Welcome to the Admin Panel" heading
- Three Card components, each linking to a section:
  - "Store Info" — edit name, phone, hours, address
  - "Content" — edit page texts, hero, sections
  - "Boards" — edit board prices, descriptions, images
- Each card has a title, one-line description, and a "Edit →" link
  </action>
  <verify>
1. `npm run build` passes
2. `npm run dev` starts
3. Login at /admin/login with correct password
4. Dashboard at /admin shows three section cards
5. Sidebar nav links are visible
6. Logout button calls logoutAction and redirects to /admin/login
  </verify>
  <done>Admin layout renders with sidebar nav, dashboard shows three section cards, logout works</done>
</task>

<task type="auto">
  <name>Task 2: Create store info editor</name>
  <files>src/app/admin/site-info/page.tsx, src/app/admin/site-info/actions.ts</files>
  <action>
Create `src/app/admin/site-info/actions.ts`:
- `"use server"` directive
- Import `getSiteConfig`, `saveSiteConfig` from `@/lib/site-config`
- Import `SiteConfig` from `@/types/site-config`
- Define Zod schema for store info fields:
  ```ts
  const storeInfoSchema = z.object({
    storeName: z.string().min(1),
    tagline: z.string().min(1),
    phone: z.string().min(1),
    address: z.string().min(1),
    hours: z.object({
      sunday: z.string(), monday: z.string(), tuesday: z.string(),
      wednesday: z.string(), thursday: z.string(), friday: z.string(), saturday: z.string()
    }),
    social: z.object({
      instagram: z.string(), yelp: z.string(), facebook: z.string()
    })
  })
  ```
- Export `saveStoreInfoAction(formData: FormData)`:
  1. Parse and validate formData using the schema (use `Object.fromEntries(formData)` for flat fields; hours fields come as `hours.monday` etc.)
  2. Fetch current full config: `const current = await getSiteConfig()`
  3. Merge: `const updated = { ...current, ...parsed }`
  4. Call `saveSiteConfig(updated)`
  5. Return `{ success: true }` or `{ error: string }` on validation failure

Create `src/app/admin/site-info/page.tsx` (async Server Component):
- Fetch current config: `const config = await getSiteConfig()`
- Render a form (react-hook-form + zod, `"use client"` inner component or separate client form component) pre-populated with current config values
- Fields:
  - Store Name (Input)
  - Tagline (Input)
  - Phone (Input)
  - Address (Input or Textarea)
  - Hours section: 7 rows (day name + Input for hours string e.g. "10:00 AM - 7:30 PM")
  - Social section: Instagram URL (Input), Yelp URL (Input), Facebook URL (Input)
- "Save Changes" Button at bottom
- On submit: call `saveStoreInfoAction(formData)`, show success toast (use existing `sonner` toast) or error message
- Revalidate the page after save so form shows updated values (use `revalidatePath('/admin/site-info')` in the server action)

**Pattern**: Create a `StoreInfoForm` client component in the same file or a separate `_components/store-info-form.tsx`. Pass `defaultValues={config}` from the server page.
  </action>
  <verify>
1. `npm run build` passes
2. Visit /admin/site-info — form loads pre-populated with current store info
3. Change the store name to "Test Store" → click Save → success toast appears
4. Reload /admin/site-info — "Test Store" persists in the form (was saved to Vercel Blob)
5. Visit the home page — store name now shows "Test Store" (config is live)
6. Restore original value and save again
  </verify>
  <done>Store info form pre-populates from config, saves successfully to Vercel Blob, changes reflect on the live site after ISR revalidation (60s max)</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Admin dashboard shell (layout + index) and store info editor (/admin/site-info) with save-to-Vercel-Blob</what-built>
  <how-to-verify>
    1. Run: `npm run dev`
    2. Visit: http://localhost:3000/admin/login — log in
    3. Dashboard at /admin — three section cards visible, sidebar nav works
    4. Click "Store Info" or sidebar link → /admin/site-info loads with pre-filled form
    5. Edit the phone number → click "Save Changes" → success toast appears
    6. Reload /admin/site-info — edited phone number persists
    7. Visit http://localhost:3000 — check that the phone number updated in the site footer/header (within 60s ISR, or force refresh)
    8. Click logout in sidebar — redirects to /admin/login, /admin redirects to /admin/login again
    **Note:** Vercel Blob requires BLOB_READ_WRITE_TOKEN. Locally this may be empty — test with the Vercel CLI (`vercel dev`) for full Blob functionality, or set a test token from the Vercel dashboard.
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds with no TypeScript errors
- [ ] Admin layout renders with sidebar nav and logout
- [ ] /admin dashboard shows three section cards
- [ ] /admin/site-info form pre-populates from getSiteConfig()
- [ ] Saving store info calls saveSiteConfig() and persists
- [ ] Logout works and clears admin_session cookie
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors introduced
- Admin dashboard is navigable and functional
- Store info edits persist and propagate to the live site
  </success_criteria>

<output>
After completion, create `.planning/phases/05-admin-panel-cms/05-04-SUMMARY.md`:

```markdown
---
phase: 05-admin-panel-cms
plan: 04
subsystem: admin-ui
tags: [admin, cms, vercel-blob, react-hook-form]

requires:
  - phase: 05-admin-panel-cms plan 03
    provides: Site reads from getSiteConfig()
provides:
  - Admin layout with sidebar navigation and logout
  - /admin dashboard index
  - /admin/site-info editor (store name, phone, address, hours, social)
affects: [05-admin-panel-cms]

tech-stack:
  added: []
  patterns:
    - Async server page fetches config, passes to client form component as defaultValues
    - Server action validates with zod, merges with current config, saves to Blob

key-files:
  created:
    - src/app/admin/layout.tsx
    - src/app/admin/page.tsx
    - src/app/admin/site-info/page.tsx
    - src/app/admin/site-info/actions.ts

key-decisions:
  - []

patterns-established:
  - Admin editor pattern: async server page → client form with defaultValues → server action → saveSiteConfig

issues-created: []
---

# Phase 5 Plan 4: Admin UI - Store Info Summary

**[Substantive one-liner]**

## Accomplishments

## Files Created/Modified

## Decisions Made

## Issues Encountered

## Next Step

Ready for 05-05-PLAN.md
```
</output>
